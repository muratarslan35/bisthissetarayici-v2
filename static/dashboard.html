<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>BIST Tarayıcı Dashboard</title>
  <style>
    body{font-family: Arial, Helvetica, sans-serif; padding: 16px; background:#f6f7fb}
    h1{margin:0 0 12px}
    table{border-collapse:collapse; width:100%; background:#fff; box-shadow:0 1px 3px rgba(0,0,0,0.08)}
    th,td{padding:8px 10px; border-bottom:1px solid #eee; text-align:left; font-size:13px}
    th{background:#fafafa; position:sticky; top:0}
    .green{color:green}
    .red{color:red}
    .muted{color:#666; font-size:12px}
  </style>
</head>
<body>
  <h1>BIST Tarama Dashboard</h1>
  <div id="last">Yükleniyor...</div>
  <table id="tbl">
    <thead>
      <tr>
        <th>Sembol</th><th>Fiyat</th><th>RSI</th><th>Sinyal</th><th>Trend</th><th>Günlük</th><th>Hacim</th><th>11:00</th><th>15:00</th><th>MA Kırılımları</th><th>Zaman (TR)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    async function load(){
      try{
        const res = await fetch('/api');
        const js = await res.json();
        const tb = document.querySelector('#tbl tbody');
        tb.innerHTML = '';
        document.getElementById('last').innerText = 'Son güncelleme: ' + (new Date()).toLocaleString();
        if(js.status !== 'ok' || !js.data) return;
        js.data.forEach(item=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.symbol}</td>
            <td>${item.current_price ?? ''}</td>
            <td class="${item.RSI && item.RSI<30 ? 'green' : (item.RSI && item.RSI>70 ? 'red' : '')}">${item.RSI ?? ''}</td>
            <td>${item.last_signal ?? ''}</td>
            <td>${item.trend ?? ''}</td>
            <td>${item.daily_change ?? ''}</td>
            <td>${item.volume ?? ''}</td>
            <td>${item.green_mum_11 ? '✅' : ''}</td>
            <td>${item.green_mum_15 ? '✅' : ''}</td>
            <td>${Object.entries(item.ma_breaks || {}).map(([k,v])=> v ? `${k}:${v}` : '').filter(Boolean).join(', ')}</td>
            <td>${item.signal_time ?? ''}</td>
          `;
          tb.appendChild(tr);
        });
      }catch(e){ console.error(e); }
    }
    load();
    setInterval(load, 60*1000);
  </script>
</body>
</html>
